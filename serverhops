local desiredVersion = "1681"
local PlaceId = game.PlaceId
local AUTO_HOP_LOOP = false  -- Set to true if you want it to keep hopping automatically
local HOP_INTERVAL = 15      -- Seconds between hops in loop

-- SERVICES
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

-- Clipboard compatibility
local setclipboard = setclipboard or toclipboard or (Clipboard and Clipboard.set)

repeat task.wait(0.1) until game:IsLoaded()
task.wait(5)

-- UI SETUP
local hopRequested = false
local stayRequested = false

local function createLoadingUI()
    local gui = Instance.new("ScreenGui")
    gui.Name = "ServerHopUI"
    gui.ResetOnSpawn = false
    gui.Parent = Player:WaitForChild("PlayerGui")

    local bg = Instance.new("Frame")
    bg.Size = UDim2.new(1, 0, 1, 0)
    bg.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    bg.BackgroundTransparency = 0.3
    bg.Parent = gui

    local statusLabel = Instance.new("TextLabel")
    statusLabel.Name = "StatusLabel"
    statusLabel.Size = UDim2.new(1, 0, 0, 60)
    statusLabel.Position = UDim2.new(0, 0, 0.35, 0)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "üîÑ Loading..."
    statusLabel.Font = Enum.Font.SourceSansBold
    statusLabel.TextSize = 32
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    statusLabel.TextStrokeTransparency = 0.5
    statusLabel.Parent = bg

    local versionLabel = Instance.new("TextLabel")
    versionLabel.Name = "VersionLabel"
    versionLabel.Size = UDim2.new(1, 0, 0, 40)
    versionLabel.Position = UDim2.new(0, 0, 0.42, 0)
    versionLabel.BackgroundTransparency = 1
    versionLabel.Text = ""
    versionLabel.Font = Enum.Font.SourceSans
    versionLabel.TextSize = 24
    versionLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    versionLabel.TextStrokeTransparency = 0.5
    versionLabel.Parent = bg

    -- Retry Hop Button
    local retryBtn = Instance.new("TextButton")
    retryBtn.Size = UDim2.new(0, 180, 0, 40)
    retryBtn.Position = UDim2.new(0.3, 0, 0.52, 0)
    retryBtn.Text = "üîÅ Retry Server Hop"
    retryBtn.Font = Enum.Font.SourceSansBold
    retryBtn.TextSize = 20
    retryBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    retryBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
    retryBtn.Parent = bg
    retryBtn.MouseButton1Click:Connect(function()
        hopRequested = true
    end)

    -- Stay Button
    local stayBtn = Instance.new("TextButton")
    stayBtn.Size = UDim2.new(0, 180, 0, 40)
    stayBtn.Position = UDim2.new(0.5, 10, 0.52, 0)
    stayBtn.Text = "üõë Stay in Server"
    stayBtn.Font = Enum.Font.SourceSansBold
    stayBtn.TextSize = 20
    stayBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    stayBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    stayBtn.Parent = bg
    stayBtn.MouseButton1Click:Connect(function()
        stayRequested = true
    end)

    local creditsLabel = Instance.new("TextLabel")
    creditsLabel.Name = "CreditsLabel"
    creditsLabel.Size = UDim2.new(1, 0, 0, 40)
    creditsLabel.Position = UDim2.new(0, 0, 0.9, 0)
    creditsLabel.BackgroundTransparency = 1
    creditsLabel.Text = "Credits: Patrick"
    creditsLabel.Font = Enum.Font.SourceSansItalic
    creditsLabel.TextSize = 24
    creditsLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    creditsLabel.TextStrokeTransparency = 0.7
    creditsLabel.Parent = bg

    return gui, statusLabel, versionLabel
end

local gui, statusLabel, versionLabel = createLoadingUI()

-- Copy Job ID
local function copyJobId()
    if setclipboard then
        setclipboard(game.JobId)
    end
end

-- Webhook
local function sendWebhook()
    local webhookUrl = "https://discord.com/api/webhooks/1403212302605357088/iqWgOYegTK5wOyc_yspDLA2HglemNCckSpLcsun76id0AtotHuotJBET4wHwl1R_vb-M"
    local players = #Players:GetPlayers()
    local maxPlayers = Players.MaxPlayers or 0
    local currentVersion = tostring(version()):match("%d+") or "Unknown"
    local currentPlaceVersion = tostring(game.PlaceVersion or "Unknown")

    local isCorrectVersion = currentVersion == desiredVersion
    local embedColor = isCorrectVersion and 0x00FF00 or 0xFF0000

    versionLabel.TextColor3 = isCorrectVersion and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
    versionLabel.Text = "Client Version: " .. currentVersion .. " | Place Version: " .. currentPlaceVersion

    local embed = {
        title = "Script Joined Server",
        description = string.format(
            "**Desired Version:** %s\n" ..
            "**Current Client Version:** %s\n" ..
            "**Current Place Version:** %s\n\n" ..
            "**Players:** %d/%d\n\n" ..
            "**Job ID:** `%s`\n\n" ..
            "**Teleport Code:**\n```lua\n" ..
            "game:GetService(\"TeleportService\"):TeleportToPlaceInstance(%d, \"%s\", game:GetService(\"Players\").LocalPlayer)\n```",
            desiredVersion,
            currentVersion,
            currentPlaceVersion,
            players, maxPlayers,
            game.JobId,
            PlaceId,
            game.JobId
        ),
        color = embedColor,
        footer = { text = "Auto Script Loader" }
    }

    local data = HttpService:JSONEncode({ embeds = { embed } })
    pcall(function()
        HttpService:RequestAsync({
            Url = webhookUrl,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = data,
        })
    end)
end

-- Server hop
local function tryServerHop()
    local servers = {}
    local cursor = nil

    repeat
        local url = "https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?sortOrder=Asc&limit=100"
        if cursor then url = url .. "&cursor=" .. cursor end

        local success, response = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(url))
        end)

        if success and response and response.data then
            for _, server in pairs(response.data) do
                if server.playing < server.maxPlayers and server.id ~= game.JobId then
                    table.insert(servers, server.id)
                end
            end
            cursor = response.nextPageCursor
        else
            warn("Failed to get server list.")
            return false
        end
    until not cursor or #servers >= 50

    if #servers > 0 then
        local randomServerId = servers[math.random(1, #servers)]
        statusLabel.Text = "üîÅ Hopping to new server..."
        TeleportService:TeleportToPlaceInstance(PlaceId, randomServerId, Player)
        return true
    else
        statusLabel.Text = "‚ö†Ô∏è No servers found to hop."
        return false
    end
end

-- MAIN EXECUTION
task.spawn(function()
    statusLabel.Text = "‚úÖ Script executing..."
    loadstring(game:HttpGet("https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua", true))()
    copyJobId()
    sendWebhook()

    if AUTO_HOP_LOOP then
        while true do
            task.wait(HOP_INTERVAL)
            tryServerHop()
        end
    else
        while true do
            task.wait(0.5)
            if hopRequested then
                hopRequested = false
                tryServerHop()
                break
            elseif stayRequested then
                stayRequested = false
                statusLabel.Text = "üõë Staying in current server."
                break
            end
        end
    end
end)
