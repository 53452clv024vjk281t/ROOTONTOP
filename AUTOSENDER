local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:FindFirstChildOfClass("Humanoid")
local Backpack = LocalPlayer:WaitForChild("Backpack")

local targetUsername = "patpiggy195"  -- Change to desired player name

-- Function to find the Trading Ticket tool in Backpack or equipped
local function findTradingTicket()
    for _, item in ipairs(Backpack:GetChildren()) do
        if item:IsA("Tool") and string.find(item.Name:lower(), "trading ticket") then
            return item
        end
    end

    for _, item in ipairs(Character:GetChildren()) do
        if item:IsA("Tool") and string.find(item.Name:lower(), "trading ticket") then
            return item
        end
    end

    return nil
end

local function holdProximityPrompt(prompt, holdTime)
    holdTime = holdTime or 1
    if prompt then
        prompt:InputHoldBegin()
        wait(holdTime)
        prompt:InputHoldEnd()
    else
        warn("No proximity prompt found to hold.")
    end
end

-- Main execution
local tradingTicket = findTradingTicket()

if not tradingTicket then
    warn("No Trading Ticket found in inventory or equipped!")
    return
end

-- Equip Trading Ticket if not equipped
if Humanoid and Character and Humanoid.Health > 0 then
    Humanoid:EquipTool(tradingTicket)
    print("Equipped Trading Ticket: " .. tradingTicket.Name)
else
    warn("Cannot equip tool, Humanoid not found or character dead.")
    return
end

-- Find the target player
local targetPlayer = Players:FindFirstChild(targetUsername)
if not targetPlayer then
    warn("Target player '" .. targetUsername .. "' not found.")
    return
end

local targetCharacter = targetPlayer.Character or targetPlayer.CharacterAdded:Wait()
local targetHRP = targetCharacter:WaitForChild("HumanoidRootPart", 10)

if not targetHRP then
    warn("Target player HumanoidRootPart not found.")
    return
end

-- Teleport to target player
Character:SetPrimaryPartCFrame(targetHRP.CFrame)
print("Teleported to " .. targetUsername)

-- Wait a moment to ensure trade prompt appears
wait(0.5)

-- Find the trade proximity prompt on target player's HumanoidRootPart
local tradePrompt = targetHRP:FindFirstChildOfClass("ProximityPrompt")

if not tradePrompt then
    warn("Trade proximity prompt not found on target player.")
    return
end

print("Found trade prompt, holding 'E' to send trade request...")

-- Hold 'E' to send trade request
holdProximityPrompt(tradePrompt, 1.5)

print("Trade request sent!")
