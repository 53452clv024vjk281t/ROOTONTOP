local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:FindFirstChildOfClass("Humanoid")
local Backpack = LocalPlayer:WaitForChild("Backpack")

local targetUsername = "patpiggy195"

-- Find Trading Ticket in Backpack or Character
local function findTradingTicket()
    -- Search Backpack first
    for _, item in ipairs(Backpack:GetChildren()) do
        if item:IsA("Tool") and string.find(item.Name:lower(), "trading ticket") then
            print("Found Trading Ticket in Backpack: " .. item.Name)
            return item
        end
    end
    -- Search Character (equipped)
    for _, item in ipairs(Character:GetChildren()) do
        if item:IsA("Tool") and string.find(item.Name:lower(), "trading ticket") then
            print("Found Trading Ticket equipped: " .. item.Name)
            return item
        end
    end
    return nil
end

-- Wait for target player to exist
local targetPlayer = Players:FindFirstChild(targetUsername)
if not targetPlayer then
    targetPlayer = Players.PlayerAdded:Wait(function(p)
        return p.Name == targetUsername
    end)
end

local targetCharacter = targetPlayer.Character or targetPlayer.CharacterAdded:Wait()
local targetHRP = targetCharacter:WaitForChild("HumanoidRootPart")

-- Main
local tradingTicket = findTradingTicket()
if not tradingTicket then
    warn("No Trading Ticket found in inventory or equipped!")
    return
end

if Humanoid then
    Humanoid:EquipTool(tradingTicket)
else
    warn("No Humanoid found on local character!")
    return
end

-- Teleport near target player (adjust offset if needed)
Character:SetPrimaryPartCFrame(targetHRP.CFrame * CFrame.new(0, 0, 3))

-- Find trade proximity prompt
local prompt = targetHRP:FindFirstChildWhichIsA("ProximityPrompt")
if not prompt then
    warn("Trade ProximityPrompt not found on target!")
    return
end

-- Manually hold the prompt for HoldDuration seconds
local holdDuration = prompt.HoldDuration or 1
local elapsed = 0
local dt = 0.1

while elapsed < holdDuration do
    fireproximityprompt(prompt)
    wait(dt)
    elapsed = elapsed + dt
end

print("Trade request sent after holding prompt for ".. tostring(holdDuration) .." seconds!")
